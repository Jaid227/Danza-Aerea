<!DOCTYPE html>
<html>
<head>
<title>Zona de Comentarios</title>
<link rel="stylesheet" href="estilos.css">
</head>

<body>

<div class="contenedor">

<h1>ğŸ’¬ Comunidad</h1>
<p class="sub">
Comparte tu opiniÃ³n y apoya con un ğŸ‘
</p>


<div class="tarjeta">

  <input id="nombre"
   placeholder="Tu nombre">

  <textarea id="mensaje"
   placeholder="Escribe algo genial...">
  </textarea>

  <button class="btn" onclick="enviar()">
    Publicar
  </button>

</div>


<div id="lista"></div>

</div>



<script>

const API =
"https://script.google.com/macros/s/AKfycbxM8WNEmdasgS6_5OQzXdoXJG5hAEQgGJs0OHg21ZQdykhY9rLclb_dUYmsAEJ8yhsm0A/exec";



// ===== ENVIAR =====
function enviar(){

  let nombre =
   document.getElementById("nombre").value;

  let mensaje =
   document.getElementById("mensaje").value;

  if(!nombre || !mensaje){
    alert("Llena todo");
    return;
  }

  fetch(API,{
    method:"POST",
    mode:"no-cors",
    body:JSON.stringify({
      nombre:nombre,
      mensaje:mensaje
    })
  })
  .then(()=>{
    document.getElementById("mensaje").value="";
    cargar();
  });

}



// ===== LIKE ÃšNICO =====
function like(id){

  let usuario =
   document.getElementById("nombre").value;

  if(!usuario){
    alert("Escribe tu nombre para dar like");
    return;
  }

  fetch(API +
   "?like=" + id +
   "&usuario=" + usuario)

  .then(r=>r.text())
  .then(res=>{

    if(res=="ya"){
      alert("Ya diste like ğŸ˜Š");
    }

    cargar();
  });

}



// ===== CARGAR =====
function cargar(){

fetch(API)
.then(r=>r.json())
.then(datos=>{

let html="";

datos.reverse().forEach(d=>{

html+=`

<div class="comentario">

<div class="cabecera">
  <span class="user">
   ğŸ‘¤ ${d.nombre}
  </span>

  <span class="fecha">
   ${new Date(d.fecha)
     .toLocaleDateString()}
  </span>
</div>

<p class="texto">
 ${d.mensaje}
</p>

<div class="zona-like">

<button class="like"
 onclick="like(${d.id})">
 ğŸ‘ ${d.likes||0}
</button>

</div>

</div>
`;

});

document.getElementById("lista")
        .innerHTML=html;

});

}

cargar();

</script>

</body>
</html>
